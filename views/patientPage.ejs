<!DOCTYPE html>
<html>
<head>
 
  <title>Patient Page</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
  <script type="text/javascript" src="/files/js/stickyfillmin.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
  <script type="text/javascript" src="/files/js/pageScript.js"></script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Nunito"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Pacifico"/>
  <link rel="stylesheet" type="text/css" href="/files/css/views.css">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.css" rel="stylesheet" type="text/css" />

  <body> 
    <div class="background">
      <div class="sidebarContainer">
        <div class="row">
          <nav class="col-sm-2 sidebar">
            <div class = "sidebar sticky " >
              <div class = "basicInfo"> 
                <h2 id = "name"><%= data.firstName%> <%= data.lastName%></h2>
                <br>
                <p id="ageSex"> (Age) 19, <%=data.sex%> </p>
                <p id="dob"><%= data.birthdate%></p>
                <p id="weightHeight"> <%= data.weight%> kg, <%= data.height%> cm </p>
                <p id="allergiesSide"> Allergies: (loop patient.allergies[i]) </p>
              </div>
           <ul class="nav nav-pills nav-stacked links">
              <li class="active current"><a href='/patientPage/<%=data.id%>'>Patient Summary</a></li>
              <li><a href="/patientPage/<%=data.id%>/history">Information &amp; History </a></li>
              <li><a href="/patientPage/<%=data.id%>/problemList">Problem List</a></li>
              <li><a href="/patientPage/<%=data.id%>/medications">Medication List</a></li>
              <li><a href="/patientPage/<%=data.id%>/immunization">Immunization Record</a></li>
              <li><a href="/patientPage/<%=data.id%>/allergies">Allergies</a></li>
              <li><a href="/patientPage/<%=data.id%>/wellChildCheck">Well Child Check Page</a></li>
              <li><a href="/patientPage/<%=data.id%>/wellChildCheckForm">Well Child Check Form</a></li>
              <li><a href="/patientPage/<%=data.id%>/testing">Testing</a></li>
              <li><a href="/patientPage/<%=data.id%>/growthCharts">Growth Charts</a></li>
              <li><a href="#section7">Nurse Notes</a></li>
              <li><a href="#section8">Scans</a></li>
            </ul>
            </div>
          </nav>
          <div class="col-lg">   
            <div class = "card header">
             <div class = "topRight">
              <a> Welcome, "*User Name*"  | </a>
              <a href="/" class="btn btn-outline-success"> Logout </a>
            </div>
            <div>
        <a href="/patientSearch" style="text-decoration : none "> <p class = "label" id = "R-plus"> R+ </p>
            <p class = "label" id = "Childrens">Childrens</p> </a>
              <a href="#Pharmacy" class = "top-nav" id = "pharmacy">Pharmacy</a>
              <a href="#AllPatients" class = "top-nav" id = "rec-pat">Recent Patients</a>
              <a href="/patientSearch" class = "top-nav" id = "search-pat">Search Patients</a>
              <a href="/form" class = "top-nav" id = "search-pat">Add Patient</a>

            </div>
          </div>
          

          <div class = "content-container">
           <div class = "card box summary">
            <h3 class="title"> Patient Summary </h3>
          </div>


          <div id="updates" class="box card">
            <table class="w3-table-all">
              <div class="subTitle">
                Upcoming Updates 
              </div>
              <thead>
                <tr class="w3-light-grey">
                  <th>Date</th>
                  <th>Action</th>
                  <th>Status</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody id="updatesTableBody" >
                <tr>
                  <td>12-12-12</td>
                  <td>Do the well child check</td>
                  <td>Overdue</td>
                  <td>None</td>
                </tr>
              </tbody>
            </table>
          </div>


          <div id="allergies" class="box card">
            <table class="w3-table-all">
              <div class="subTitle">
                Allergies 
              </div>
              <thead>
                <tr class="w3-light-grey">
                  <th>Allergen</th>
                  <th>Reaction</th>
                  <th>Severity</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody id="allergiesTableBody" >
                <tr>
                  <td>Peanuts</td>
                  <td>Hives</td>
                  <td>Mild</td>
                  <td>Avoid tree nuts</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div id="socialHistory" class="box card">
            <table class="w3-table-all">
              <div class="subTitle">
                Brief Social History 
              </div>
              <thead>
                <tr class="w3-light-grey">
                  <th>Notes</th>
                  
                </tr>
              </thead>
              <tbody id="socialHistoryTableBody" >
                <tr>
                  <td>Mother left her on the side of the street</td>
                </tr>
              </tbody>
            </table>
          </div>

          
        </div>
      </div>
    </div>
  </div>
</body>
<script>
  var patientId= JSON.parse('<%=data.id%>');
  console.log('patientID here' + patientId);
  var birthdateNew= new Date('<%=data.birthdate%>').valueOf();
  $('#age').text('Age: ' + getAge(birthdateNew));
  $(document).ready(function(){  
    var elements = document.querySelectorAll('.sticky');
    Stickyfill.add(elements);
  // so basically we just need to make post requests here that 
  // pass in the patient Id and then we can render the information on the page
  /*
    $.ajax({
      type: 'POST',
      url: '/getAllergyInfo', or something like this
      data: {
        id: patientId,
      },
      success: function(data) {
        renderData(data);
      }
    });
    */
  });
  var getPatientData = function(patient) {
    var temp = patient;
    var updates = [{date: '12-12-12', note: 'Do the test', status: 'Overdue'}]
    var allergies = [{item: 'dairy', severity: 'Mild', note: 'Avoid diary products'}]
    var socialHistory = 'Parents died from disease when child was young.';
    console.log('here:' + patient);
    var cards = "";
    var date = new Date(2018,2,12);
    var i = 1;
    var patient = patient[i];
    
    $('#allergiesSide').text('Allergies: ' + allergies[0].item );


  }


  function getAge(fromdate, todate){
    if(todate){
      todate= new Date(todate);
    }
    else {
      todate= new Date();
      var age= [], fromdate= new Date(fromdate),
      y= [todate.getFullYear(), fromdate.getFullYear()],
      ydiff= y[0]-y[1],
      m= [todate.getMonth() + 1, fromdate.getMonth()],
      mdiff= m[0]-m[1],
      d= [todate.getDate(), fromdate.getDate()],
      ddiff= d[0]-d[1];
      if(mdiff < 0 || (mdiff=== 0 && ddiff<0))--ydiff;
      if(mdiff<0) mdiff+= 12;
      if(ddiff<0){
        fromdate.setMonth(m[1]+1, 0);
        ddiff= fromdate.getDate()-d[1]+d[0];
        --mdiff;
      }
      w = Math.floor(ddiff/7);
      ddiff = ddiff % 7;
      // 3 or older -> show year
      if (ydiff > 2){
        age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
      } 
      else if (ydiff> 0) {
      // Over a year -> show year and month
      age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
      if(mdiff> 0) age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
      // Less than a year -> show month and day
    } else if (mdiff> 3) {
      age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
      if (w> 0) age.push(w+ ' week' + (w> 1? 's':''));
    } else if (mdiff>0) {
      age.push(mdiff+ ' month'+(mdiff> 1? 's ':' '));
      if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
    } else {
      if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
      if(ddiff> 0) age.push(ddiff+ ' day'+(ddiff> 1? 's':''));
    }
    if(age.length>1) age.splice(age.length-1,0,' and ');    
    return age.join('');
  }
}
</script>
</body>
</html>

